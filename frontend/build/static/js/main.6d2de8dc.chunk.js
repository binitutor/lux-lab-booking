(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{29:function(t,e,n){},30:function(t,e,n){},31:function(t,e,n){},32:function(t,e,n){},33:function(t,e,n){},44:function(t,e,n){},45:function(t,e,n){},46:function(t,e,n){},47:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){},50:function(t,e,n){},56:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n(1),s=n.n(a),c=n(18),o=n.n(c),r=(n(29),n(7)),l=n(8),d=n(10),u=n(9),h=(n(30),n(13)),j=n(2),b=(n(31),s.a.createContext({token:null,userId:null,login:function(t,e,n){},logout:function(){}})),f=function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(t){var i;return Object(r.a)(this,n),(i=e.call(this,t)).state={isLogin:!0},i.switchModeHandler=function(){i.setState((function(t){return{isLogin:!t.isLogin}}))},i.submitHandler=function(t){t.preventDefault();var e=i.emailEl.current.value,n=i.passwordEl.current.value;if(0!==e.trim().length&&0!==n.trim().length){var a={query:"\n        query Login($email: String!, $password: String!) {\n          login(email: $email, password: $password) {\n            userId\n            token\n            tokenExpiration\n          }\n        }\n      ",variables:{email:e,password:n}};i.state.isLogin||(a={query:"\n          mutation CreateUser($email: String!, $password: String!) {\n            createUser(userInput: {email: $email, password: $password}) {\n              _id\n              email\n            }\n          }\n        ",variables:{email:e,password:n}}),fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(t){t.data.login.token&&i.context.login(t.data.login.token,t.data.login.userId,t.data.login.tokenExpiration)})).catch((function(t){console.log(t)}))}},i.emailEl=s.a.createRef(),i.passwordEl=s.a.createRef(),i}return Object(l.a)(n,[{key:"render",value:function(){return Object(i.jsxs)("form",{className:"auth-form",onSubmit:this.submitHandler,children:[Object(i.jsxs)("div",{className:"form-control",children:[Object(i.jsx)("label",{htmlFor:"email",children:"E-Mail"}),Object(i.jsx)("input",{type:"email",id:"email",ref:this.emailEl})]}),Object(i.jsxs)("div",{className:"form-control",children:[Object(i.jsx)("label",{htmlFor:"password",children:"Password"}),Object(i.jsx)("input",{type:"password",id:"password",ref:this.passwordEl})]}),Object(i.jsxs)("div",{className:"form-actions",children:[Object(i.jsx)("button",{type:"submit",children:"Submit"}),Object(i.jsxs)("button",{type:"button",onClick:this.switchModeHandler,children:["Switch to ",this.state.isLogin?"Signup":"Login"]})]})]})}}]),n}(a.Component);f.contextType=b;var p=f,m=(n(32),function(){return Object(i.jsx)("div",{className:"spinner",children:Object(i.jsx)("div",{className:"lds-dual-ring"})})}),v=(n(33),function(t){return Object(i.jsx)("ul",{className:"bookings__list",children:t.bookings.map((function(e){return Object(i.jsxs)("li",{className:"bookings__item",children:[Object(i.jsxs)("div",{className:"bookings__item-data",children:[e.event.title," -"," ",new Date(e.createdAt).toLocaleDateString()]}),Object(i.jsx)("div",{className:"bookings__item-actions",children:Object(i.jsx)("button",{className:"btn",onClick:t.onDelete.bind(undefined,e._id),children:"Cancel"})})]},e._id)}))})}),O=n(16),g=n(22),x={Cheap:{min:0,max:100},Normal:{min:100,max:200},Expensive:{min:200,max:1e7}},k=function(t){var e={labels:[],datasets:[]},n=[],a=function(i){var a=t.bookings.reduce((function(t,e){return e.event.price>x[i].min&&e.event.price<x[i].max?t+1:t}),0);n.push(a),e.labels.push(i),e.datasets.push({fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:n}),(n=Object(O.a)(n))[n.length-1]=0};for(var s in x)a(s);return Object(i.jsx)("div",{style:{textAlign:"center"},children:Object(i.jsx)(g.Bar,{data:e})})},y=(n(44),void 0),E=function(t){return Object(i.jsxs)("div",{className:"bookings-control",children:[Object(i.jsx)("button",{className:"list"===t.activeOutputType?"active":"",onClick:t.onChange.bind(y,"list"),children:"List"}),Object(i.jsx)("button",{className:"chart"===t.activeOutputType?"active":"",onClick:t.onChange.bind(y,"chart"),children:"Chart"})]})},C=function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={isLoading:!1,bookings:[],outputType:"list"},t.fetchBookings=function(){t.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n          query {\n            bookings {\n              _id\n             createdAt\n             event {\n               _id\n               title\n               date\n               price\n             }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.context.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(e){var n=e.data.bookings;t.setState({bookings:n,isLoading:!1})})).catch((function(e){console.log(e),t.setState({isLoading:!1})}))},t.deleteBookingHandler=function(e){t.setState({isLoading:!0});var n={query:"\n          mutation CancelBooking($id: ID!) {\n            cancelBooking(bookingId: $id) {\n            _id\n             title\n            }\n          }\n        ",variables:{id:e}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.context.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(n){t.setState((function(t){return{bookings:t.bookings.filter((function(t){return t._id!==e})),isLoading:!1}}))})).catch((function(e){console.log(e),t.setState({isLoading:!1})}))},t.changeOutputTypeHandler=function(e){"list"===e?t.setState({outputType:"list"}):t.setState({outputType:"chart"})},t}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.fetchBookings()}},{key:"render",value:function(){var t=Object(i.jsx)(m,{});return this.state.isLoading||(t=Object(i.jsxs)(s.a.Fragment,{children:[Object(i.jsx)(E,{activeOutputType:this.state.outputType,onChange:this.changeOutputTypeHandler}),Object(i.jsx)("div",{children:"list"===this.state.outputType?Object(i.jsx)(v,{bookings:this.state.bookings,onDelete:this.deleteBookingHandler}):Object(i.jsx)(k,{bookings:this.state.bookings})})]})),Object(i.jsx)(s.a.Fragment,{children:t})}}]),n}(a.Component);C.contextType=b;var S=C,w=(n(45),function(t){return Object(i.jsxs)("div",{className:"modal",children:[Object(i.jsx)("header",{className:"modal__header",children:Object(i.jsx)("h1",{children:t.title})}),Object(i.jsx)("section",{className:"modal__content",children:t.children}),Object(i.jsxs)("section",{className:"modal__actions",children:[t.canCancel&&Object(i.jsx)("button",{className:"btn",onClick:t.onCancel,children:"Cancel"}),t.canConfirm&&Object(i.jsx)("button",{className:"btn",onClick:t.onConfirm,children:t.confirmText})]})]})}),N=(n(46),function(t){return Object(i.jsx)("div",{className:"backdrop"})}),_=(n(47),function(t){return Object(i.jsxs)("li",{className:"events__list-item",children:[Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:t.title}),Object(i.jsxs)("h2",{children:["$",t.price," - ",new Date(t.date).toLocaleDateString()]})]}),Object(i.jsx)("div",{children:t.userId===t.creatorId?Object(i.jsx)("p",{children:"Your the owner of this event."}):Object(i.jsx)("button",{className:"btn",onClick:t.onDetail.bind(undefined,t.eventId),children:"View Details"})})]},t.eventId)}),T=(n(48),function(t){var e=t.events.map((function(e){return Object(i.jsx)(_,{eventId:e._id,title:e.title,price:e.price,date:e.date,userId:t.authUserId,creatorId:e.creator._id,onDetail:t.onViewDetail},e._id)}));return Object(i.jsx)("ul",{className:"event__list",children:e})}),I=(n(49),function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(t){var i;return Object(r.a)(this,n),(i=e.call(this,t)).state={creating:!1,events:[],isLoading:!1,selectedEvent:null},i.isActive=!0,i.startCreateEventHandler=function(){i.setState({creating:!0})},i.modalConfirmHandler=function(){i.setState({creating:!1});var t=i.titleElRef.current.value,e=+i.priceElRef.current.value,n=i.dateElRef.current.value,a=i.descriptionElRef.current.value;if(!(0===t.trim().length||e<=0||0===n.trim().length||0===a.trim().length)){var s={title:t,price:e,date:n,description:a};console.log(s);var c={query:"\n          mutation CreateEvent($title: String!, $desc: String!, $price: Float!, $date: String!) {\n            createEvent(eventInput: {title: $title, description: $desc, price: $price, date: $date}) {\n              _id\n              title\n              description\n              date\n              price\n            }\n          }\n        ",variables:{title:t,desc:a,price:e,date:n}},o=i.context.token;fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json",Authorization:"Bearer "+o}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(t){i.setState((function(e){var n=Object(O.a)(e.events);return n.push({_id:t.data.createEvent._id,title:t.data.createEvent.title,description:t.data.createEvent.description,date:t.data.createEvent.date,price:t.data.createEvent.price,creator:{_id:i.context.userId}}),{events:n}}))})).catch((function(t){console.log(t)}))}},i.modalCancelHandler=function(){i.setState({creating:!1,selectedEvent:null})},i.showDetailHandler=function(t){i.setState((function(e){return{selectedEvent:e.events.find((function(e){return e._id===t}))}}))},i.bookEventHandler=function(){if(i.context.token){console.log(i.state.selectedEvent);var t={query:"\n          mutation BookEvent($id: ID!) {\n            bookEvent(eventId: $id) {\n              _id\n             createdAt\n             updatedAt\n            }\n          }\n        ",variables:{id:i.state.selectedEvent._id}};fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:"Bearer "+i.context.token}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(t){console.log(t),i.setState({selectedEvent:null})})).catch((function(t){console.log(t)}))}else i.setState({selectedEvent:null})},i.titleElRef=s.a.createRef(),i.priceElRef=s.a.createRef(),i.dateElRef=s.a.createRef(),i.descriptionElRef=s.a.createRef(),i}return Object(l.a)(n,[{key:"componentDidMount",value:function(){this.fetchEvents()}},{key:"fetchEvents",value:function(){var t=this;this.setState({isLoading:!0});fetch("http://localhost:8000/graphql",{method:"POST",body:JSON.stringify({query:"\n          query {\n            events {\n              _id\n              title\n              description\n              date\n              price\n              creator {\n                _id\n                email\n              }\n            }\n          }\n        "}),headers:{"Content-Type":"application/json"}}).then((function(t){if(200!==t.status&&201!==t.status)throw new Error("Failed!");return t.json()})).then((function(e){var n=e.data.events;t.isActive&&t.setState({events:n,isLoading:!1})})).catch((function(e){console.log(e),t.isActive&&t.setState({isLoading:!1})}))}},{key:"componentWillUnmount",value:function(){this.isActive=!1}},{key:"render",value:function(){return Object(i.jsxs)(s.a.Fragment,{children:[(this.state.creating||this.state.selectedEvent)&&Object(i.jsx)(N,{}),this.state.creating&&Object(i.jsx)(w,{title:"Add Event",canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.modalConfirmHandler,confirmText:"Confirm",children:Object(i.jsxs)("form",{children:[Object(i.jsxs)("div",{className:"form-control",children:[Object(i.jsx)("label",{htmlFor:"title",children:"Title"}),Object(i.jsx)("input",{type:"text",id:"title",ref:this.titleElRef})]}),Object(i.jsxs)("div",{className:"form-control",children:[Object(i.jsx)("label",{htmlFor:"price",children:"Price"}),Object(i.jsx)("input",{type:"number",id:"price",ref:this.priceElRef})]}),Object(i.jsxs)("div",{className:"form-control",children:[Object(i.jsx)("label",{htmlFor:"date",children:"Date"}),Object(i.jsx)("input",{type:"datetime-local",id:"date",ref:this.dateElRef})]}),Object(i.jsxs)("div",{className:"form-control",children:[Object(i.jsx)("label",{htmlFor:"description",children:"Description"}),Object(i.jsx)("textarea",{id:"description",rows:"4",ref:this.descriptionElRef})]})]})}),this.state.selectedEvent&&Object(i.jsxs)(w,{title:this.state.selectedEvent.title,canCancel:!0,canConfirm:!0,onCancel:this.modalCancelHandler,onConfirm:this.bookEventHandler,confirmText:this.context.token?"Book":"Confirm",children:[Object(i.jsx)("h1",{children:this.state.selectedEvent.title}),Object(i.jsxs)("h2",{children:["$",this.state.selectedEvent.price," -"," ",new Date(this.state.selectedEvent.date).toLocaleDateString()]}),Object(i.jsx)("p",{children:this.state.selectedEvent.description})]}),this.context.token&&Object(i.jsxs)("div",{className:"events-control",children:[Object(i.jsx)("p",{children:"Share your own Events!"}),Object(i.jsx)("button",{className:"btn",onClick:this.startCreateEventHandler,children:"Create Event"})]}),this.state.isLoading?Object(i.jsx)(m,{}):Object(i.jsx)(T,{events:this.state.events,authUserId:this.context.userId,onViewDetail:this.showDetailHandler})]})}}]),n}(a.Component));I.contextType=b;var L=I,D=(n(50),function(t){return Object(i.jsx)(b.Consumer,{children:function(t){return Object(i.jsxs)("header",{className:"main-navigation",children:[Object(i.jsx)("div",{className:"main-navigation__logo",children:Object(i.jsx)("h1",{children:"EasyEvent"})}),Object(i.jsx)("nav",{className:"main-navigation__items",children:Object(i.jsxs)("ul",{children:[!t.token&&Object(i.jsx)("li",{children:Object(i.jsx)(h.b,{to:"/auth",children:"Authenticate"})}),Object(i.jsx)("li",{children:Object(i.jsx)(h.b,{to:"/events",children:"Events"})}),t.token&&Object(i.jsxs)(s.a.Fragment,{children:[Object(i.jsx)("li",{children:Object(i.jsx)(h.b,{to:"/bookings",children:"Bookings"})}),Object(i.jsx)("li",{children:Object(i.jsx)("button",{onClick:t.logout,children:"Logout"})})]})]})})]})}})}),$=function(t){Object(d.a)(n,t);var e=Object(u.a)(n);function n(){var t;Object(r.a)(this,n);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(t=e.call.apply(e,[this].concat(a))).state={token:null,userId:null},t.login=function(e,n,i){t.setState({token:e,userId:n})},t.logout=function(){t.setState({token:null,userId:null})},t}return Object(l.a)(n,[{key:"render",value:function(){return Object(i.jsx)(h.a,{children:Object(i.jsx)(s.a.Fragment,{children:Object(i.jsxs)(b.Provider,{value:{token:this.state.token,userId:this.state.userId,login:this.login,logout:this.logout},children:[Object(i.jsx)(D,{}),Object(i.jsx)("main",{className:"main-content",children:Object(i.jsxs)(j.d,{children:[this.state.token&&Object(i.jsx)(j.a,{from:"/",to:"/events",exact:!0}),this.state.token&&Object(i.jsx)(j.a,{from:"/auth",to:"/events",exact:!0}),!this.state.token&&Object(i.jsx)(j.b,{path:"/auth",component:p}),Object(i.jsx)(j.b,{path:"/events",component:L}),this.state.token&&Object(i.jsx)(j.b,{path:"/bookings",component:S}),!this.state.token&&Object(i.jsx)(j.a,{to:"/auth",exact:!0})]})})]})})})}}]),n}(a.Component);o.a.render(Object(i.jsx)(s.a.StrictMode,{children:Object(i.jsx)($,{})}),document.getElementById("root"))}},[[56,1,2]]]);
//# sourceMappingURL=main.6d2de8dc.chunk.js.map